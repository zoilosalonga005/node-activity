// const telegrafResponseBuilder = require('./src/telegrafResponseBuilder');
// var { Database } = require('firebase-firestore-lite')
// const D = new Database({ projectId: 'jiijii' })

// var r = async(ref) => {
//     return ref.update(UPD)
//     // try {
//     //     x = await ref.get()
//     // } catch (err) {
//     //     await ref.set({})
//     //     x = {}
//     // }
//     // return x
// }
// async function ph(photo) {
//     var getfile = await fetch('https://api.telegram.org/bot' + TOKEN + '/getFile?file_id=' + photo.file_id)
//     getfile = await getfile.json()
//     var path = 'https://api.telegram.org/file/bot' + TOKEN + '/' + getfile.result.file_path
//    // path = `https://textoverimage.moesif.com/image?image_url=${encodeURIComponent(path)}&text=S077&text_color=fffa22ff&text_size=64&y_align=middle`
//    path = await fetch('https://api.imgbb.com/1/upload?key=33612f7751537f4f27c5253f56edbf16&name=&image=' + path);
//   path = await path.json()
//     return [path.data.title, path.data.url_viewer.replace("https://", "")]
// }
// var iq = async (q) => {
//   const apiUrl = `http://recipepuppy.com/api/?q=${q.query}`
//   const response = await fetch(apiUrl)
//   const { results } = await response.json()
//   const recipes = results
//     .filter(({ thumbnail }) => thumbnail)
//     .map(({ title, href, thumbnail }) => ({
//       type: 'article',
//       id: thumbnail,
//       title: title,
//       description: title,
//       thumb_url: thumbnail,
//       input_message_content: {
//         message_text: title
//       }
//     }))
//   //   await fetch(`https://api.telegram.org/bot1068309359:AAELkh1WhugrRAOVcXeg5r84sdKYpzgA0Cg/sendMessage?chat_id=-1001431294521&text=${encodeURIComponent(JSON.stringify(recipes ,null,4))}`)  
//   return recipes
// }


// module.exports = bot => async({req,res}) => {
//     UPD = {}
//    UPD.ip = req.headers.get('CF-Connecting-IP').replace(/\./g,'_')
//    var ref = D.ref("TEMp/" + UPD.ip)
//    var ref2 = D.ref("LisT/" + UPD.ip)
//    try{
//    UPD = await ref.get()
//    } catch(err){
//       await ref.set({}) 
//    }
//        // 
//     // 
// 	// UPD = await r(UPD)
//     var h = await req.body.json()
//       try{
//     var type = Object.keys(h)[1]
//     var upd = h[type]
//     UPD.type = type
//     var from = upd.chat || upd.from
//     UPD.user = from.username || from.title
//     UPD.from = from.id
//     if(upd.query) UPD.iq = await iq(upd)
//      if(upd.id) UPD.id = upd.id
//      //if(upd.message || upd.message_id) UPD.msg = upd.message_id || upd.message.message_id
//          if (upd.entities) {
//         upd.entities.forEach((element, i) => {
//             UPD[element.type] = upd.text.substring(element.offset, (element.offset + element.length))
//         })
//     }
//     //          if (upd.query) {
//     //              var q = await iq(upd.query)
//     //                     return q.forEach( async (element, i) => {
//     //                          await fetch(`https://api.telegram.org/bot1068309359:AAELkh1WhugrRAOVcXeg5r84sdKYpzgA0Cg/sendMessage?chat_id=-1001431294521&text=${i}`)  
   
//     //        // UPD[element.type] = upd.text.substring(element.offset, (element.offset + element.length))
//     //     })
//     //             //  var u2 = await ref2.get()
//     //             //  try{
//     //             //  u2 = "x"+Object.values(u2).length
//     //             //  } catch(err){
//     //             //      u2 = "x"+u2.length
//     //             //  }
//     //             //  upd[u2] = UPD

//     // }
//     if(upd.reply_to_message) { 
//         UPD.to = upd.reply_to_message.text 
//         UPD.rep = upd.text
//     } else { delete UPD.to }
//     if(upd.location) UPD.geo = upd.location.latitude + "," + upd.location.longitude
//     if(upd.photo) {
//         UPD.pic = upd.photo[upd.photo.length - 1]
//         UPD.pic = await ph(UPD.pic)
//            if(upd.caption) { UPD.cap = upd.caption } else { delete UPD.cap}
//         var e = {}
//         e[UPD.pic[1].replace("ibb.co/",'')] = UPD
//         UPD.pic = UPD.pic[1]
// UPD.no = (1+UPD.no) || 1
//         await ref2.update(e)
//     }
//     // UPD.msg = upd.message_id || upd.message.message_id || ''
//     } catch(err){
//          await fetch(`https://api.telegram.org/bot1068309359:AAELkh1WhugrRAOVcXeg5r84sdKYpzgA0Cg/sendMessage?chat_id=-1001433099398&text=${ err.stack }`)
//     }
    
    
  
//     var v = await bot.handleUpdate(h, telegrafResponseBuilder(res))
// await ref.set(UPD)
//     res.status = 200
// }